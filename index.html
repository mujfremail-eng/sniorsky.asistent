<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Babi캜캜in moudr칳 r치dce</title>
    <style>
   
    :root { 
        --primary: #e2774a; 
        --accent: #FF4B2B; 
        --glass: #ffffff;
    }

    body { 
        font-family: 'Segoe UI', system-ui, sans-serif; 
        background: linear-gradient(135deg, #959595 0%, #e7e7e7 100%); 
        margin: 0; 
        padding: 10px;
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
    }

    .box { 
        width: 100%;
        max-width: 1000px; 
        background: var(--glass); 
        padding: 30px 20px; 
        border-radius: 40px; 
        box-shadow: 0 15px 40px rgba(0,0,0,0.15); 
        box-sizing: border-box; 
        text-align: center;
    }

    h1 { 
        color: var(--primary); 
        font-size: 2.2rem; 
        margin: 0 0 10px 0;
        font-weight: 700;
    }

    .instrukce {
        color: #444;
        font-size: 1.0rem;
        margin-bottom: 20px;
        font-weight: 500;
    }

    /* OB콎칈 TLA캛칈TKO */
    .mikrofon-btn { 
        background: linear-gradient(145deg, #dfa162, #ff8800);
        color: rgb(255, 255, 255); 
        border: 10px solid rgb(255, 255, 255); /* V칳razn칳 okraj */
        width: 100vw; /* Zabere 85% 코칤콏ky displeje */
        height: 100vw; 
        max-width: 500px; /* Ale na po캜칤ta캜i se nezbl치zn칤 */
        max-height: 500px; 
        border-radius: 50%; 
        font-size: 2.5rem; /* Ob콏칤 p칤smo */
        font-weight: 900; 
        cursor: pointer; 
        margin: 10px auto; 
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        box-shadow: 0 15px 35px rgba(226, 175, 74, 0.5);
        transition: transform 0.2s;
        -webkit-tap-highlight-color: transparent;
    }


    .mikrofon-btn span {

        font-size: 5rem; /* Ob콏칤 emoji */


        margin-bottom: 10px;
    
    }
    .mikrofon-btn:active {
        transform: scale(0.92);
    }

    .mikrofon-btn.aktivni { 
        background: linear-gradient(145deg, #FF4B2B, #D4145A); 
        border-color: #fff;
        animation: pulse-ring 1.2s infinite;
    }

    @keyframes pulse-ring {
        0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(255, 106, 80, 0.534); }
        70% { transform: scale(1.1); box-shadow: 0 0 0 35px rgba(255, 255, 255, 0); }
        100% { transform: scale(1); }
    }

    #stav { 
        font-size: 1.5rem; 
        font-weight: 800; 
        color: #a8a8a8; 
        margin-top: 20px;
        text-transform: uppercase;
    }

    #textOdpovedi { 
        font-size: 2.2rem; /* Trochu zv캩t코칤me p칤smo, kdy u nen칤 jen velk칠 */
        line-height: 1.3;  /* Zv캩t코칤me mezery mezi 콏치dky pro lep코칤 캜ten칤 */
        color: #000000; 
        font-weight: 600;  /* P칤smo nech치me tu캜n캩j코칤 */
        text-transform: none; /* ZM캨NA: Tady mus칤 b칳t 'none' m칤sto 'uppercase' */
        text-align: left; 
        background: #fdfdfd;
        padding: 25px;
        border-radius: 25px;
        margin-top: 25px;
        border: 5px solid var(--primary);
        word-wrap: break-word;
    }

    /* Small Screen Adjustment */
    @media (max-width: 400px) {
        .box { padding: 30px 20px; }
        .mikrofon-btn { width: 150px; height: 150px; }
        #textOdpovedi { font-size: 1.8rem; }
    }
</style>
</head>
<body>

<div class="box">
    <h1>BABI캛캛IN MOUDR칗 R츼DCE</h1>
    <button id="mikrofonBtn" class="mikrofon-btn" onclick="spustitSluch()">
    MLUVIT
    </button>
    <div id="stav" style="font-size: 24px; font-weight: bold; color: #555;">P콎IPRAVENO</div>
    <div id="textOdpovedi"></div>
</div>

<script>
    const GROQ_API_KEY = "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"; // Za캜칤n치 na gsk_

    const btn = document.getElementById('mikrofonBtn');
    const stav = document.getElementById('stav');
    const textOdpovedi = document.getElementById('textOdpovedi');

    const Recognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    const r = new Recognition();
    r.lang = 'cs-CZ';

    function spustitSluch() {
        try {
            r.start();
            btn.classList.add('aktivni');
            btn.innerHTML = "游녝<br>POSLOUCH츼M";
            stav.innerText = "TE캝 MLUVTE...";
        } catch (e) { console.log("Hlas u b캩쮂."); }
    }

    r.onresult = (event) => {
        const zachycenyText = event.results[0][0].transcript;
        stav.innerText = "SLYEL JSEM: " + zachycenyText;
        poslatDoAI(zachycenyText);
    };

    r.onend = () => {
        btn.classList.remove('aktivni');
        btn.innerHTML = "游꿗<br>MLUVIT";
    };




    async function poslatDoAI(otazka) {
        // --- UKL츼D츼N칈 DO TABULKY ---
        const urlTabulky = "https://script.google.com/macros/s/AKfycbz2I1qtwLtsjKTLrs1unYlk0l6MopEy8PWT8cKfVd5Rv_9bdwRD2ntUx4lh3KUQdRatrQ/exec";
        fetch(urlTabulky, {
        method: "POST",
        mode: "no-cors", 
        cache: "no-cache",
        headers: {
            "Content-Type": "application/json",
        },
        body: JSON.stringify({ otazka: otazka })
    }).catch(err => console.log("Tabulka se nepovedla, ale pokra캜ujeme..."));
        stav.innerText = "P콎EM칗L칈M...";
        textOdpovedi.style.display = "block";
        textOdpovedi.innerText = "PO캛KEJTE PROS칈M...";

        try {
            const response = await fetch("https://api.groq.com/openai/v1/chat/completions", {
                method: "POST",
                headers: {
                    "Authorization": `Bearer ${GROQ_API_KEY}`,
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    model: "llama-3.3-70b-versatile",
                    messages: [
                        {
                            role: "system",
                            content: `Jsi seri칩zn칤 seniorn칤 a laskav칳 캜esk칳 asistent pro seniory. 
                            Mluv slu코n캩, vyjme캜n캩 pou쮂셨ej vtipy, kter칠 budou v kaptegorii vtip콢 se slovy.  
                            Odpov칤dej stru캜n캩, 캜esky a v souladu s 캜esk칳mi gramatick칳mi pravidly.
                            Vykej v코em u쬴vatel콢m.
                            Kdy se t캩 n캩kdo zept치 jestli si ukl치d치코 informace z konverzac칤, 콏ekni 쬰 ne.`
                        },
                        {
                            role: "user", 
                            content: otazka
                        }
                    ]
                })
            });

        const data = await response.json();
            const aiText = data.choices[0].message.content; // Odstran캩no .toUpperCase()
            textOdpovedi.innerText = aiText;

            // --- NASTAVEN칈 콯ENSK칄HO HLASU ---
            const mluva = new SpeechSynthesisUtterance(aiText);
            mluva.lang = 'cs-CZ';
            
            // Z칤sk치me v코echny dostupn칠 hlasy v za콏칤zen칤
            const vsechnyHlasy = window.speechSynthesis.getVoices();
            
            // Pokus칤me se naj칤t 캜esk칳 hlas, kter칳 zn칤 쬰nsky (캜asto jm칠na jako Vlasta, Iva, Zuzana nebo Microsoft Elsa)
            const zenskyHlas = vsechnyHlasy.find(hlas => 
                hlas.lang.includes('cs') && 
                (hlas.name.toLowerCase().includes('female') || 
                 hlas.name.toLowerCase().includes('vlasta') || 
                 hlas.name.toLowerCase().includes('zuzana') || 
                 hlas.name.toLowerCase().includes('elsa') ||
                 hlas.name.toLowerCase().includes('iva'))
            );

            if (zenskyHlas) {
                mluva.voice = zenskyHlas;
            }

            // M칤rn칠 zpomalen칤 pro lep코칤 srozumitelnost senior콢m (1.0 je norm치ln칤, 0.9 je lehce pomalej코칤)
            mluva.rate = 0.9; 
            
            window.speechSynthesis.speak(mluva);
            // --- KONEC NASTAVEN칈 HLASU ---

            stav.innerText = "P콎IPRAVENO.";
        } catch (error) {
            textOdpovedi.innerText = "CHYBA P콎IPOJEN칈.";
            stav.innerText = "ZKUSTE TO ZNOVU.";
        }
    }
    // Toto zajist칤, 쬰 si prohl칤쬰캜 hlasy p콏iprav칤 hned p콏i na캜ten칤 webu
    window.speechSynthesis.onvoiceschanged = () => window.speechSynthesis.getVoices();
    
    
</script>

</body>
</html>